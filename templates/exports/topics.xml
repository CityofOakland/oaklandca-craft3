{%- cache using key "topics-export" for 1 day -%}
{%- macro entries(field, title, blockType) -%}
  {%- set blockType = (blockType ?? "Entries") ~ "Block" -%}
  {%- if field | length -%}
    <{{ blockType }}>
      <Heading>{{ title }}</Heading>
      <Entries>
        {%- for entry in field.all() -%}
          <EntryRelation>
            <EntryTitle>{{ entry.title }}</EntryTitle>
            <EntryID>{{ entry.id }}</EntryID>
          </EntryRelation>
        {%- endfor -%}
      </Entries>
    </{{ blockType }}>
  {%- endif -%}
{%- endmacro -%}
{%- import _self as macro -%}
<?xml version="1.0" encoding="UTF-8"?>
<entries>
  {%- set query = craft.entries.section("topics").type("topics").contentBuilder(":empty:").limit(25) -%}
  {%- paginate query as pageInfo, pageEntries -%}
  {%- for entry in pageEntries -%}
  <entry>
    <Title>{{ entry.title }}</Title>
    <ID>{{ entry.title }}</ID>
    <Entries>
      {{ macro.entries(entry.pageServices, "Services") }}
      {{ macro.entries(entry.pageResources, "Resources") }}
      {{ macro.entries(entry.pageDocuments, "Documents") }}
      {{ macro.entries(entry.pageProjects, "Projects") }}
      {{ macro.entries(entry.pageTopics, "Topics") }}
      {{ macro.events(entry.pageEvents, "Events", "Events") }}
      <MeetingsBlock>
        <Heading>Meetings</Heading>
        <Autofill>Yes</Autofill>
      </MeetingsBlock>
      {{ macro.entries(entry.pageNews, "News", "News") }}
    </Entries>
  </entry>
  {%- endfor -%}
  <paginate>
    {%- if pageInfo.prevUrl %}<prev>{{ pageInfo.prevUrl }}</prev>{%- endif -%}
    {%- if pageInfo.nextUrl %}<next>{{ pageInfo.nextUrl }}</next>{%- endif -%}
  </paginate>
</entries>
{%- endcache -%}